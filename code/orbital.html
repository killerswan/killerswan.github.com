<!doctype html>
<html>
<head>
<title>Kevin Cantu</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="copyright" content="Kevin Cantu (c) 2010">

<!-- style -->
<link rel="icon" href="http://kevincantu.org/lib/icon/udot.png" type="image/png">
<link rel="stylesheet" type="text/css" href="http://kevincantu.org/lib/alpha.css">
<link rel="stylesheet" type="text/css" href="http://kevincantu.org/lib/cantuHeader.css">

<!-- jQuery 1.4.2 --> 
<script src="http://kevincantu.org/lib/3p/jquery/jquery-1.4.2.js"></script>

<!-- Google Maps v3 -->
<script src="http://maps.google.com/maps/api/js?sensor=true"></script>

<!-- other JavaScript -->
<script src="http://kevincantu.org/lib/3p/crockford/crockford.js"></script> 
<script src="http://kevincantu.org/lib/cantu.js"></script>


<script>
$(document).ready(function () {


    var sunCalc = function () {
    /*
        TODO: update the following from PHP to JavaScript

    // May 2006 and Feb 2007
    // an implementation of equations found in Wikipedia
    // to calculate times of sunrise and sunset


    // DEFINITION
    $RAD_PER_DEG = pi()/180;
    $EARTH_W = 15 * $RAD_PER_DEG; // earth rotates 15 degrees/hour [angular speed]


    // INPUT
    $latitude_deg    =  34.4;  //Santa Barbara
    $longitude_deg   = 119.7;  //Santa Barbara
    //$latitude_deg  =  41.3;  //Omaha
    //$longitude_deg =  96.0;  //Omaha
    $UTC = -8;
    $DST = 1;


    // CALCULATION
    $sec_per_day  = 24*60*60.0;
    $sec_per_year = 365.25*$sec_per_day;
    $N = ceil( fmod(time(), $sec_per_year) / $sec_per_day );  // day of the year


    $declination_deg = -23.45*cos((2*pi()/365)*($N+10));
    $altitude_deg = -0.83; // wikipedia, unspecified almanacs


    $latitude    = $latitude_deg    * $RAD_PER_DEG;
    $longitude   = $longitude_deg   * $RAD_PER_DEG;
    $declination = $declination_deg * $RAD_PER_DEG;
    $altitude    = $altitude_deg    * $RAD_PER_DEG;

    // below this point, ALL angles are given in radians


    // Sunrise Equation
    $hour_angle = acos( ( sin($altitude) - sin($declination)*sin($latitude) )/( cos($declination)*cos($latitude) ) );
    $offset = $hour_angle / $EARTH_W;


    // Adjustment for EoT, DST, location
    // Equation of Time
    // E = apparent - mean
    // if event happens at mean time x, it will appear to happen E minutes earlier
    // N as above
    $B = 2*pi()*($N-81)/364;
    $E_min = 9.87*sin(2*$B) - 7.53*cos($B) - 1.5*sin($B);
    $E = $E_hr = $E_min/60;


    // account for longitude
    // difference between longitude in hours and the timezone's time
    $longitude_delta = $longitude/$EARTH_W - (-$UTC);

    //// this works when local longitude is past the halfway point
    //// when local time is later than the time zone, you can add this time
    //$longitude_delta = fmod($longitude, $EARTH_W) / $EARTH_W;

    // cumulative adjustments: local_noon != 12:00 PM
    $local_noon = 12 + $longitude_delta + $DST - $E;


    // FINAL CALCULATION
    $sunset  = $local_noon + $offset;
    $sunrise = $local_noon - $offset;

    // TO USE P.M.
    $sunset -= 12;

    // OUTPUT
    $sunset_hr = floor($sunset);
    $sunset_min = 60 * ($sunset - $sunset_hr);
    $sunrise_hr = floor($sunrise);
    $sunrise_min = 60 * ($sunrise - $sunrise_hr);

    */
    };


    var foundYou = function (position) {

        ////////////////////////        
        // PRINT LOCATION
        var newP = document.createElement("p");

        newP.innerHTML = "Your latitude is " + position.coords.latitude +
                        ", your longitude is " + position.coords.longitude +
                        ", and your altitude is " + position.coords.altitude +
                        " (as of " + position.timestamp + ")...";

        document.getElementById("results").appendChild(newP);
        // This closure, ultimately, is leaky: the new <p> can later seen by other functions.


        ////////////////////////        
        // MAKE A MAP
        // Anyways, I want a map.
        var mapDisplay = document.getElementById("map_canvas");

        // Here is a map from Google!
        var coord = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        var opts = {
            zoom: 12, // higher number is zoomed more
            center: coord,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var m = new google.maps.Map(mapDisplay, opts);

        // a caption!
        var caption = document.createElement("p");
        caption.setAttribute("class", "caption");
        caption.innerHTML = "You are probably here:";
        mapDisplay.parentNode.insertBefore(caption, mapDisplay);
    }


    var marco = function (e) {
        if (e.code === 1) {
            // denied
            alert("Feel free to look at my code, I'm not doing anything funny with your location.  Yet.  Error recvd.: " + e.message);
        } else if (e.code === 2) {
            alert("Your position seems unavailable: " + e.message);
        } else if (e.code === 3) {
            alert("Timeout reached in getting your position: " + e.message);
        } else {
            alert("Error in calling getCurrentPosition(): " + e.message);
        }
    }

    // get time and do callback
    var s = navigator.geolocation.getCurrentPosition(foundYou, marco, {enableHighAccuracy: true});




});  //END JQUERY READY

/*
(function () {
    var s = document.getElementById("showResults").onclick = function () {
        alert(document.getElementById("results").firstChild.innerHTML);
    };
})();
*/


// GOOGLE ANALYTICS
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-13261525-1']);
_gaq.push(['_trackPageview']);
(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

</script> 
</head>
<body>

<script>
    CANTU.writeHeader();
</script>

<div id="paper">

    <h1>orbital</h1>

    <p>If this is your first time visiting, you should see a prompt
       from your browser (Chrome or Firefox) to allow 'kevincantu.org' 
       to know your location.  If you want to, click "Allow" or "Share
       Location" so this page will work!
    </p>
    <p>
        On this page, I'm experiementing with geolocation. [<a href="http://diveintohtml5.org/geolocation.html">1</a>]
        Although the function retrieving your location is called within a closure,
        the popup button has access to the value of the paragraph displaying your location: 
        like many parts of a page/mashup, it has the ability to read that.  Be careful!
    </p>

    <div id="results"></div>

    <!-- <input type="button" id="showResults" value="popup..."> -->

    <div id="map_canvas" style="max-width: 100%; height: 200px"></div>


</div><!-- paper -->
</body>
</html>


