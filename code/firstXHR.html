<!doctype html><html><head><meta charset="utf-8"><!-- Kevin Cantu © 2010 -->

    <title>Kevin Cantu</title>

    <link href="http://kevincantu.org/lib/beta.css" type="text/css" rel="stylesheet">
    <link href="http://kevincantu.org/lib/icon/udot.png" type="image/png" rel="icon">

    <script src="http://kevincantu.org/lib/3p/crockford/crockford.js"></script>

</head>
<body>
    <!-- depends on the body -->
    <script src="http://kevincantu.org/lib/betaTitle.js"></script>

    <div class="contentSection">

        <div class="contentHeader"><h1>firstXHR</h1><p>October 2010</p></div>

        <p>In making this page I refined the CSS and header files,
            but this is primarily a rough test of <code>XMLHttpRequest</code>! 
        </p>

        <p>Test unicode: KC © 2010
        </p>

        <input type="button" id="abortButton" value="Stop" disabled> <!-- untested button -->

        <div id="results"></div>
    </div>


<script>

requests = [];
abort = false;

var abortRequests = function () {
    abort = true;

    requests.forEach(function (element, index, arr) {
        element.abort();
    });
};

document.getElementById("abortButton").onclick = abortRequests;       

var fetch = function () {

    if(abort === true) {
        return;
    }

    var xr = new XMLHttpRequest();
    
    requests.push(xr);

    xr.onreadystatechange = function () {
        if (xr.readyState === 4) {
            // we got a response

            if (xr.status === 200) {
                // a good response

                document.getElementById("results").innerHTML = "<pre>" + xr.responseText.entityify() + "<\/pre>";
            } else {
                alert("XMLHttpRequest status: " + xr.status);
            }

        } else {
            /* still not ready
                0, uninit
                1, loading
                2, loaded
                3, interactive
                4, complete
            */
        }           
    };

    // use tumblr?
    //var testpg = "http://chazhuttonsfsm.tumblr.com/api/read/json?debug=1&num=7";
    // Because this is cross-site, the following error is generated by Chrome: 
    //      XMLHttpRequest cannot load http://chazhuttonsfsm.tumblr.com/api/read/json?num=7.
    //      Origin http://kevincantu.org is not allowed by Access-Control-Allow-Origin.

    // use my site instead
    
    var testpg = window.location.toString();

    xr.open("GET", testpg, true);
    xr.send(null);  // or query string

};

fetch();

</script>

</body></html>

